{% extends "layout.html" %}
{% block body %}
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
      <h1 class="h2">ぐるなびAPI</h1>
      <form method="POST">
    <div class="form-row">
        <div class="form-group">
            <input type="text" class="form-control" id="tenmei" name="tenmei">
        </div>
        <div class="form-group">
        <button type="button" class="btn btn-sm btn-outline-secondary mr-2" onclick="test()"><span data-feather="file-plus"></span> 検索</button>
        </div>
    </div>
      </form>
  </div>

      <table id="example" class="table table-striped table-bordered display nowrap" style="width:100%">
          <thead>
              <tr>
                  <th data-priority="1">ID</th>
                  <th data-priority="2">店舗名称</th>
                  <th>住所</th>
                  <th>駅名</th>
                  <th data-priority="3">営業時間</th>
              </tr>
          </thead>
          <tbody>
          </tbody>
      </table>
      
      
      <script>
      $(function() {
          var table = $('#example').DataTable( {
              responsive: true,
              "columnDefs": [
              { responsivePriority: 1, targets: 0 },
              { responsivePriority: 2, targets: 1 },
              { responsivePriority: 3, targets: 4 }
                ],
              ajax: {
                  type   : "POST",
                  url    : "{{ url_for('api.testapi') }}",
                  contentType: 'application/json',
                  dataType : 'JSON',
                  scriptCharset: 'utf-8',
                  data   : function( d ) {
                    d.tenmei= $('#tenmei').val();
                    return JSON.stringify(d);
                  },
                  "dataSrc": "rest"
              },
              'columns': [
                          {"data" : "id"},
                          {"data" : "name"},
                          {"data" : "address"},
                          {"data" : "access.station"},
                          {"data" : "opentime"}
              ],
              language: {
                emptyTable: "該当するデータが見つかりませんでした。",
                info: "_TOTAL_ 件中 _START_ 件から _END_ 件までを表示",
                infoEmpty: "",
                infoFiltered: "(_MAX_ 件からの絞り込み表示)",
                infoPostFix: "",
                thousands: ",",
                lengthMenu: "表示件数: _MENU_",
                loadingRecords: "ロード中",
                processing: "処理中...",
                search: "一覧表示内絞込検索",
                zeroRecords: "該当するデータが見つかりませんでした。",
                paginate: {
                  first: "先頭",
                  previous: "前へ",
                  next: "次へ",
                  last: "末尾"
                }
              }
          } );
          window.test = function(){
              alert('ajax test');
              table.ajax.reload();
      };
      } );
      </script> 
    <!-- dataTables core JavaScript -->
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
{% endblock %}