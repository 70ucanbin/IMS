create table "public".com_user (
    user_id character varying(20)
  , group_id character varying(20)
  , role smallint NOT NULL
  , user_name character varying(20)
  , password character varying(150)
  , email character varying(50)
  , is_active Boolean DEFAULT TRUE
  , update_user character varying(20)
  , update_date timestamp
  , PRIMARY KEY (user_id)
);

create table "public".com_item (
    item_id integer
  , item_category character varying(20)
  , item_cd character varying(20)
  , item_value character varying(100)
  , display_order integer
  , is_active Boolean DEFAULT TRUE
  , update_user character varying(20)
  , update_date timestamp
  , PRIMARY KEY (item_id, item_category, item_cd)
);

create table "public".tra_client_work (
    client_work_id integer
  , user_id character varying(20)
  , work_year smallint
  , work_month smallint
  , work_day smallint
  , rest_flg smallint DEFAULT 0
  , order_cd character varying(20)
  , task_cd character varying(20)
  , sub_order_cd character varying(20)
  , work_time time
  , note character varying(200)
  , PRIMARY KEY (client_work_id, user_id, work_year, work_month)
);

create table "public".tra_monthly_report (
    user_id character varying(20)
  , work_year smallint
  , work_month smallint
  , work_day smallint
  , rest_flg smallint
  , work_details character varying(100)
  , start_work_time time
  , end_work_time time
  , normal_working_hours numeric(4, 2)
  , overtime_hours numeric(4, 2)
  , holiday_work_hours numeric(4, 2)
  , note character varying(200)
  , PRIMARY KEY (user_id, work_year, work_month, work_day)
);

create table "public".tra_travel_expenses (
    travel_expenses_id integer
  , user_id character varying(20) NOT NULL
  , entry_year smallint NOT NULL
  , entry_month smallint NOT NULL
  , expense_date character varying(30)
  , expense_item character varying(50)
  , route character varying(50)
  , transit character varying(50)
  , payment integer
  , file_name character varying(100)
  , note character varying(200)
  , PRIMARY KEY (travel_expenses_id)
);

create table "public".tra_order (
    order_id integer
  , client_cd character varying(20)
  , group_cd character varying(20)
  , order_cd character varying(20)
  , order_value character varying(100)
  , display_order integer
  , is_active Boolean DEFAULT TRUE
  , update_user character varying(20)
  , update_date timestamp
  , PRIMARY KEY (order_id,client_cd,group_cd,order_cd)
);

create table "public".tra_sub_order (
    sub_order_id integer
  , client_cd character varying(20)
  , group_cd character varying(20)
  , order_cd character varying(20)
  , sub_order_cd character varying(20)
  , sub_order_value character varying(100)
  , display_order integer
  , is_active Boolean DEFAULT TRUE
  , update_user character varying(20)
  , update_date timestamp
  , PRIMARY KEY (sub_order_id,client_cd,group_cd,order_cd,sub_order_cd)
);


drop table com_user;

CREATE SEQUENCE tra_client_work_seq START 1;
CREATE SEQUENCE tra_travel_expenses_seq START 1;
CREATE SEQUENCE com_item_seq START 1;
CREATE SEQUENCE tra_order_seq START 1;
CREATE SEQUENCE tra_sub_order_seq START 1;



drop SEQUENCE com_group;

ALTER table com_user RENAME COLUMN user_role TO role;

select days.day as day, to_char(sum(work_time), 'HH24:MI') as time

from (
select date_part('day',  CURRENT_DATE + i ) as day
from generate_series(date '2019-11-01'- CURRENT_DATE, date '2019-11-30' - CURRENT_DATE ) i
) days

left join tra_client_work tcw
     on tcw.work_day = days.day
	 and tcw.user_id = 'k4111'
group by day
order by day